!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@antv/x6")):"function"==typeof define&&define.amd?define(["exports","@antv/x6"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).X6PluginMinimap={},t.X6)}(this,(function(t,e){"use strict";class i extends e.View{get scroller(){return this.graph.getPlugin("scroller")}get graphContainer(){return this.scroller?this.scroller.container:this.graph.container}constructor(t){super(),this.name="minimap",this.options=Object.assign(Object.assign({},s.defaultOptions),t),e.CssLoader.ensure(this.name,".x6-widget-minimap {\n  position: relative;\n  display: table-cell;\n  box-sizing: border-box;\n  overflow: hidden;\n  text-align: center;\n  vertical-align: middle;\n  background-color: #fff;\n  user-select: none;\n}\n.x6-widget-minimap .x6-graph {\n  display: inline-block;\n  box-shadow: 0 0 4px 0 #eee;\n  cursor: pointer;\n}\n.x6-widget-minimap .x6-graph > svg {\n  pointer-events: none;\n  shape-rendering: optimizespeed;\n}\n.x6-widget-minimap .x6-graph .x6-node * {\n  /* stylelint-disable-next-line */\n  vector-effect: initial;\n}\n.x6-widget-minimap-viewport {\n  position: absolute;\n  box-sizing: content-box !important;\n  margin: -2px 0 0 -2px;\n  border: 2px solid #31d0c6;\n  cursor: move;\n}\n.x6-widget-minimap-viewport-zoom {\n  position: absolute;\n  right: 0;\n  bottom: 0;\n  box-sizing: border-box;\n  width: 12px;\n  height: 12px;\n  margin: 0 -6px -6px 0;\n  background-color: #fff;\n  border: 2px solid #31d0c6;\n  border-radius: 50%;\n  cursor: nwse-resize;\n}\n")}init(t){this.graph=t,this.updateViewport=e.FunctionExt.debounce(this.updateViewport.bind(this),0),this.container=document.createElement("div"),e.Dom.addClass(this.container,this.prefixClassName(o.root));const i=document.createElement("div");this.container.appendChild(i),this.viewport=document.createElement("div"),e.Dom.addClass(this.viewport,this.prefixClassName(o.viewport)),this.options.scalable&&(this.zoomHandle=document.createElement("div"),e.Dom.addClass(this.zoomHandle,this.prefixClassName(o.zoom)),e.Dom.appendTo(this.zoomHandle,this.viewport)),e.Dom.append(this.container,this.viewport),e.Dom.css(this.container,{width:this.options.width,height:this.options.height,padding:this.options.padding}),this.options.container&&this.options.container.appendChild(this.container),this.sourceGraph=this.graph;const s=Object.assign(Object.assign({},this.options.graphOptions),{container:i,model:this.sourceGraph.model,interacting:!1,grid:!1,background:!1,embedding:!1});this.targetGraph=this.options.createGraph?this.options.createGraph(s):new e.Graph(s),this.updatePaper(this.sourceGraph.options.width,this.sourceGraph.options.height),this.startListening()}startListening(){this.scroller?e.Dom.Event.on(this.graphContainer,`scroll${this.getEventNamespace()}`,this.updateViewport):(this.sourceGraph.on("translate",this.onTransform,this),this.sourceGraph.on("scale",this.onTransform,this),this.sourceGraph.on("model:updated",this.onModelUpdated,this)),this.sourceGraph.on("resize",this.updatePaper,this),this.delegateEvents({mousedown:"startAction",touchstart:"startAction",[`mousedown .${this.prefixClassName("graph")}`]:"scrollTo",[`touchstart .${this.prefixClassName("graph")}`]:"scrollTo"})}stopListening(){this.scroller?e.Dom.Event.off(this.graphContainer,this.getEventNamespace()):(this.sourceGraph.off("translate",this.onTransform,this),this.sourceGraph.off("scale",this.onTransform,this),this.sourceGraph.off("model:updated",this.onModelUpdated,this)),this.sourceGraph.off("resize",this.updatePaper,this),this.undelegateEvents()}onRemove(){this.stopListening(),this.targetGraph.model=new e.Model,this.targetGraph.dispose()}onTransform(t){(t.ui||this.targetGraphTransforming)&&this.updateViewport()}onModelUpdated(){this.targetGraph.zoomToFit()}updatePaper(t,e){let i,o;"object"==typeof t?(i=t.width,o=t.height):(i=t,o=e);const s=this.sourceGraph.options,n=this.sourceGraph.transform.getScale(),r=this.options.width-2*this.options.padding,a=this.options.height-2*this.options.padding;i/=n.sx,o/=n.sy,this.ratio=Math.min(r/i,a/o);const h=this.ratio,p=s.x*h/n.sx,c=s.y*h/n.sy;return i*=h,o*=h,this.targetGraph.resize(i,o),this.targetGraph.translate(p,c),this.scroller?this.targetGraph.scale(h,h):this.targetGraph.zoomToFit(),this.updateViewport(),this}updateViewport(){const t=this.sourceGraph.transform.getScale(),i=this.targetGraph.transform.getScale();let o=null;o=this.scroller?this.scroller.clientToLocalPoint(0,0):this.graph.graphToLocal(0,0);const s=e.Dom.position(this.targetGraph.container),n=this.targetGraph.translate();n.ty=n.ty||0,this.geometry={top:s.top+o.y*i.sy+n.ty,left:s.left+o.x*i.sx+n.tx,width:this.graphContainer.clientWidth*i.sx/t.sx,height:this.graphContainer.clientHeight*i.sy/t.sy},e.Dom.css(this.viewport,this.geometry)}startAction(t){const e=this.normalizeEvent(t),i=e.target===this.zoomHandle?"zooming":"panning",{tx:o,ty:n}=this.sourceGraph.translate(),r={action:i,clientX:e.clientX,clientY:e.clientY,scrollLeft:this.graphContainer.scrollLeft,scrollTop:this.graphContainer.scrollTop,zoom:this.sourceGraph.zoom(),scale:this.sourceGraph.transform.getScale(),geometry:this.geometry,translateX:o,translateY:n};this.targetGraphTransforming=!0,this.delegateDocumentEvents(s.documentEvents,r)}doAction(t){const e=this.normalizeEvent(t),i=e.clientX,o=e.clientY,s=e.data;switch(s.action){case"panning":{const t=this.sourceGraph.transform.getScale(),e=(i-s.clientX)*t.sx,n=(o-s.clientY)*t.sy;this.scroller?(this.graphContainer.scrollLeft=s.scrollLeft+e/this.ratio,this.graphContainer.scrollTop=s.scrollTop+n/this.ratio):this.sourceGraph.translate(s.translateX-e/this.ratio,s.translateY-n/this.ratio);break}case"zooming":{const t=s.scale,e=s.geometry,o=1+(s.clientX-i)/e.width/t.sx;s.frameId&&cancelAnimationFrame(s.frameId),s.frameId=requestAnimationFrame((()=>{this.sourceGraph.zoom(o*s.zoom,{absolute:!0,minScale:this.options.minScale,maxScale:this.options.maxScale})}));break}}}stopAction(){this.undelegateDocumentEvents(),this.targetGraphTransforming=!1}scrollTo(t){const i=this.normalizeEvent(t);let o,s;const n=this.targetGraph.translate();if(n.ty=n.ty||0,null==i.offsetX){const t=e.Dom.offset(this.targetGraph.container);o=i.pageX-t.left,s=i.pageY-t.top}else o=i.offsetX,s=i.offsetY;const r=(o-n.tx)/this.ratio,a=(s-n.ty)/this.ratio;this.sourceGraph.centerPoint(r,a)}dispose(){this.remove(),e.CssLoader.clean(this.name)}}var o,s;!function(t,e,i,o){var s,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(r=(n<3?s(r):n>3?s(e,i,r):s(e,i))||r);n>3&&r&&Object.defineProperty(e,i,r)}([e.View.dispose()],i.prototype,"dispose",null),function(t){t.root="widget-minimap",t.viewport=`${t.root}-viewport`,t.zoom=`${t.viewport}-zoom`}(o||(o={})),function(t){t.defaultOptions={width:300,height:200,padding:10,scalable:!0,minScale:.01,maxScale:16,graphOptions:{},createGraph:t=>new e.Graph(t)},t.documentEvents={mousemove:"doAction",touchmove:"doAction",mouseup:"stopAction",touchend:"stopAction"}}(s||(s={})),t.MiniMap=i}));
//# sourceMappingURL=index.js.map
