!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@antv/x6"),require("@antv/x6-plugin-dnd")):"function"==typeof define&&define.amd?define(["exports","@antv/x6","@antv/x6-plugin-dnd"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).X6PluginStencil={},t.X6,t.X6PluginDnd)}(this,(function(t,e,n){"use strict";var i;!function(t){t.getMaxDim=function(t,e){return t.reduce(((t,n)=>Math.max(n.getSize()[e],t)),0)},t.getNodesInRow=function(t,e,n){const i=[];for(let o=n*e,s=o+n;o<s;o+=1)i.push(t[o]);return i},t.getNodesInColumn=function(t,e,n){const i=[];for(let o=e,s=t.length;o<s;o+=n)i.push(t[o]);return i},t.accumulate=function(t,e){return t.reduce(((t,e,n)=>(t.push(t[n]+e),t)),[e||0])}}(i||(i={}));class o extends e.View{get targetScroller(){return this.options.target.getPlugin("scroller")}get targetGraph(){return this.options.target}get targetModel(){return this.targetGraph.model}constructor(t={}){super(),this.name="stencil",e.CssLoader.ensure(this.name,".x6-widget-dnd {\n  position: absolute;\n  top: -10000px;\n  left: -10000px;\n  z-index: 999999;\n  display: none;\n  cursor: move;\n  opacity: 0.7;\n  pointer-events: 'cursor';\n}\n.x6-widget-dnd.dragging {\n  display: inline-block;\n}\n.x6-widget-dnd.dragging * {\n  pointer-events: none !important;\n}\n.x6-widget-dnd .x6-graph {\n  background: transparent;\n  box-shadow: none;\n}\n.x6-widget-stencil {\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  left: 0;\n}\n.x6-widget-stencil::after {\n  position: absolute;\n  top: 0;\n  display: block;\n  width: 100%;\n  height: 20px;\n  padding: 8px 0;\n  line-height: 20px;\n  text-align: center;\n  opacity: 0;\n  transition: top 0.1s linear, opacity 0.1s linear;\n  content: ' ';\n  pointer-events: none;\n}\n.x6-widget-stencil-content {\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  left: 0;\n  height: auto;\n  overflow-x: hidden;\n  overflow-y: auto;\n}\n.x6-widget-stencil .x6-node [magnet]:not([magnet='passive']) {\n  pointer-events: none;\n}\n.x6-widget-stencil-group {\n  padding: 0;\n  padding-bottom: 8px;\n  overflow: hidden;\n  user-select: none;\n}\n.x6-widget-stencil-group.collapsed {\n  height: auto;\n  padding-bottom: 0;\n}\n.x6-widget-stencil-group-title {\n  position: relative;\n  margin-top: 0;\n  margin-bottom: 0;\n  padding: 4px;\n  cursor: pointer;\n}\n.x6-widget-stencil-title,\n.x6-widget-stencil-group > .x6-widget-stencil-group-title {\n  overflow: hidden;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  user-select: none;\n}\n.x6-widget-stencil .unmatched {\n  opacity: 0.3;\n}\n.x6-widget-stencil .x6-node.unmatched {\n  display: none;\n}\n.x6-widget-stencil-group.unmatched {\n  display: none;\n}\n.x6-widget-stencil-search-text {\n  position: relative;\n  z-index: 1;\n  box-sizing: border-box;\n  width: 100%;\n  height: 30px;\n  max-height: 30px;\n  line-height: 30px;\n  outline: 0;\n}\n.x6-widget-stencil.not-found::after {\n  opacity: 1;\n  content: attr(data-not-found-text);\n}\n.x6-widget-stencil.not-found.searchable::after {\n  top: 30px;\n}\n.x6-widget-stencil.not-found.searchable.collapsable::after {\n  top: 50px;\n}\n.x6-widget-stencil {\n  color: #333;\n  background: #f5f5f5;\n}\n.x6-widget-stencil-content {\n  position: absolute;\n}\n.x6-widget-stencil.collapsable > .x6-widget-stencil-content {\n  top: 32px;\n}\n.x6-widget-stencil.searchable > .x6-widget-stencil-content {\n  top: 80px;\n}\n.x6-widget-stencil.not-found::after {\n  position: absolute;\n}\n.x6-widget-stencil.not-found.searchable.collapsable::after {\n  top: 80px;\n}\n.x6-widget-stencil.not-found.searchable::after {\n  top: 60px;\n}\n.x6-widget-stencil-group {\n  height: auto;\n  margin-bottom: 1px;\n  padding: 0;\n  transition: none;\n}\n.x6-widget-stencil-group .x6-graph {\n  background: transparent;\n  box-shadow: none;\n}\n.x6-widget-stencil-group.collapsed {\n  height: auto;\n  max-height: 31px;\n}\n.x6-widget-stencil-title,\n.x6-widget-stencil-group > .x6-widget-stencil-group-title {\n  position: relative;\n  left: 0;\n  box-sizing: border-box;\n  width: 100%;\n  height: 32px;\n  padding: 0 5px 0 8px;\n  color: #666;\n  font-weight: 700;\n  font-size: 12px;\n  line-height: 32px;\n  cursor: default;\n  transition: all 0.3;\n}\n.x6-widget-stencil-title:hover,\n.x6-widget-stencil-group > .x6-widget-stencil-group-title:hover {\n  color: #444;\n}\n.x6-widget-stencil-title {\n  background: #e9e9e9;\n}\n.x6-widget-stencil-group > .x6-widget-stencil-group-title {\n  background: #ededed;\n}\n.x6-widget-stencil.collapsable > .x6-widget-stencil-title,\n.x6-widget-stencil-group.collapsable > .x6-widget-stencil-group-title {\n  padding-left: 32px;\n  cursor: pointer;\n}\n.x6-widget-stencil.collapsable > .x6-widget-stencil-title::before,\n.x6-widget-stencil-group.collapsable > .x6-widget-stencil-group-title::before {\n  position: absolute;\n  top: 6px;\n  left: 8px;\n  display: block;\n  width: 18px;\n  height: 18px;\n  margin: 0;\n  padding: 0;\n  background-color: transparent;\n  background-repeat: no-repeat;\n  background-position: 0 0;\n  border: none;\n  content: ' ';\n}\n.x6-widget-stencil.collapsable > .x6-widget-stencil-title::before,\n.x6-widget-stencil-group.collapsable > .x6-widget-stencil-group-title::before {\n  background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0iIzAwMCIgZmlsbC1ydWxlPSJub256ZXJvIj48cGF0aCBkPSJNOS4zNzUuNUM0LjY4Ny41Ljg3NSA0LjMxMy44NzUgOWMwIDQuNjg4IDMuODEyIDguNSA4LjUgOC41IDQuNjg3IDAgOC41LTMuODEyIDguNS04LjUgMC00LjY4Ny0zLjgxMy04LjUtOC41LTguNXptMCAxNS44ODZDNS4zMDMgMTYuMzg2IDEuOTkgMTMuMDcyIDEuOTkgOXMzLjMxMi03LjM4NSA3LjM4NS03LjM4NVMxNi43NiA0LjkyOCAxNi43NiA5YzAgNC4wNzItMy4zMTMgNy4zODYtNy4zODUgNy4zODZ6Ii8+PHBhdGggZD0iTTEyLjc1MyA4LjQ0M0g1Ljk5N2EuNTU4LjU1OCAwIDAwMCAxLjExNmg2Ljc1NmEuNTU4LjU1OCAwIDAwMC0xLjExNnoiLz48L2c+PC9zdmc+');\n  opacity: 0.4;\n  transition: all 0.3s;\n}\n.x6-widget-stencil.collapsable > .x6-widget-stencil-title:hover::before,\n.x6-widget-stencil-group.collapsable > .x6-widget-stencil-group-title:hover::before {\n  opacity: 0.6;\n}\n.x6-widget-stencil.collapsable.collapsed > .x6-widget-stencil-title::before,\n.x6-widget-stencil-group.collapsable.collapsed > .x6-widget-stencil-group-title::before {\n  background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0iIzAwMCIgZmlsbC1ydWxlPSJub256ZXJvIj48cGF0aCBkPSJNOS4zNzUuNUM0LjY4Ny41Ljg3NSA0LjMxMy44NzUgOWMwIDQuNjg4IDMuODEyIDguNSA4LjUgOC41IDQuNjg3IDAgOC41LTMuODEyIDguNS04LjUgMC00LjY4Ny0zLjgxMy04LjUtOC41LTguNXptMCAxNS44ODZDNS4zMDMgMTYuMzg2IDEuOTkgMTMuMDcyIDEuOTkgOXMzLjMxMi03LjM4NSA3LjM4NS03LjM4NVMxNi43NiA0LjkyOCAxNi43NiA5YzAgNC4wNzItMy4zMTMgNy4zODYtNy4zODUgNy4zODZ6Ii8+PHBhdGggZD0iTTEyLjc1MyA4LjQ0M0g1Ljk5N2EuNTU4LjU1OCAwIDAwMCAxLjExNmg2Ljc1NmEuNTU4LjU1OCAwIDAwMC0xLjExNnoiLz48cGF0aCBkPSJNOC44MTcgNS42MjN2Ni43NTZhLjU1OC41NTggMCAwMDEuMTE2IDBWNS42MjNhLjU1OC41NTggMCAxMC0xLjExNiAweiIvPjwvZz48L3N2Zz4=');\n  opacity: 0.4;\n}\n.x6-widget-stencil.collapsable.collapsed > .x6-widget-stencil-title:hover::before,\n.x6-widget-stencil-group.collapsable.collapsed > .x6-widget-stencil-group-title:hover::before {\n  opacity: 0.6;\n}\n.x6-widget-stencil input[type='search'] {\n  appearance: textfield;\n}\n.x6-widget-stencil input[type='search']::-webkit-search-cancel-button,\n.x6-widget-stencil input[type='search']::-webkit-search-decoration {\n  appearance: none;\n}\n.x6-widget-stencil-search-text {\n  display: block;\n  width: 90%;\n  margin: 8px 5%;\n  padding-left: 8px;\n  color: #333;\n  background: #fff;\n  border: 1px solid #e9e9e9;\n  border-radius: 12px;\n  outline: 0;\n}\n.x6-widget-stencil-search-text:focus {\n  outline: 0;\n}\n.x6-widget-stencil::after {\n  color: #808080;\n  font-weight: 600;\n  font-size: 12px;\n  background: 0 0;\n}\n"),this.graphs={},this.groups={},this.options=Object.assign(Object.assign({},o.defaultOptions),t),this.init()}init(){if(this.dnd=new n.Dnd(this.options),this.onSearch=e.FunctionExt.debounce(this.onSearch,200),this.container=document.createElement("div"),e.Dom.addClass(this.container,this.prefixClassName(s.base)),e.Dom.attr(this.container,"data-not-found-text",this.options.notFoundText||"No matches found"),this.options.collapsable=this.options.collapsable&&this.options.groups&&this.options.groups.some((t=>!1!==t.collapsable)),this.options.collapsable){e.Dom.addClass(this.container,"collapsable");this.options.groups&&this.options.groups.every((t=>t.collapsed||!1===t.collapsable))&&e.Dom.addClass(this.container,"collapsed")}const t=document.createElement("div");e.Dom.addClass(t,this.prefixClassName(s.title)),t.innerHTML=this.options.title,e.Dom.appendTo(t,this.container),this.options.search&&(e.Dom.addClass(this.container,"searchable"),e.Dom.append(this.container,this.renderSearch())),this.content=document.createElement("div"),e.Dom.addClass(this.content,this.prefixClassName(s.content)),e.Dom.appendTo(this.content,this.container);const i=this.options.stencilGraphOptions||{};if(this.options.groups&&this.options.groups.length)this.options.groups.forEach((t=>{const n=document.createElement("div");e.Dom.addClass(n,this.prefixClassName(s.group)),e.Dom.attr(n,"data-name",t.name),(null==t.collapsable&&this.options.collapsable||!1!==t.collapsable)&&e.Dom.addClass(n,"collapsable"),e.Dom.toggleClass(n,"collapsed",!0===t.collapsed);const o=document.createElement("h3");e.Dom.addClass(o,this.prefixClassName(s.groupTitle)),o.innerHTML=t.title||t.name;const a=document.createElement("div");e.Dom.addClass(a,this.prefixClassName(s.groupContent));const l=t.graphOptions,r=new e.Graph(Object.assign(Object.assign(Object.assign({},i),l),{container:document.createElement("div"),model:i.model||new e.Model,width:t.graphWidth||this.options.stencilGraphWidth,height:t.graphHeight||this.options.stencilGraphHeight,interacting:!1,preventDefaultBlankAction:!1}));e.Dom.append(a,r.container),e.Dom.append(n,[o,a]),e.Dom.appendTo(n,this.content),this.groups[t.name]=n,this.graphs[t.name]=r}));else{const t=new e.Graph(Object.assign(Object.assign({},i),{container:document.createElement("div"),model:i.model||new e.Model,width:this.options.stencilGraphWidth,height:this.options.stencilGraphHeight,interacting:!1,preventDefaultBlankAction:!1}));e.Dom.append(this.content,t.container),this.graphs[a.defaultGroupName]=t}this.startListening()}renderSearch(){const t=document.createElement("div");e.Dom.addClass(t,this.prefixClassName(s.search));const n=document.createElement("input");return e.Dom.attr(n,{type:"search",placeholder:this.options.placeholder||"Search"}),e.Dom.addClass(n,this.prefixClassName(s.searchText)),e.Dom.append(t,n),t}startListening(){const t=this.prefixClassName(s.title),e=this.prefixClassName(s.searchText),n=this.prefixClassName(s.groupTitle);this.delegateEvents({[`click .${t}`]:"onTitleClick",[`touchstart .${t}`]:"onTitleClick",[`click .${n}`]:"onGroupTitleClick",[`touchstart .${n}`]:"onGroupTitleClick",[`input .${e}`]:"onSearch",[`focusin .${e}`]:"onSearchFocusIn",[`focusout .${e}`]:"onSearchFocusOut"}),Object.keys(this.graphs).forEach((t=>{this.graphs[t].on("cell:mousedown",this.onDragStart,this)}))}stopListening(){this.undelegateEvents(),Object.keys(this.graphs).forEach((t=>{this.graphs[t].off("cell:mousedown",this.onDragStart,this)}))}load(t,e){return Array.isArray(t)?this.loadGroup(t,e):this.options.groups&&Object.keys(this.options.groups).forEach((e=>{t[e]&&this.loadGroup(t[e],e)})),this}loadGroup(t,n){const i=this.getModel(n);if(i){const n=t.map((t=>e.Node.isNode(t)?t:e.Node.create(t)));i.resetCells(n)}const o=this.getGroup(n);let s=this.options.stencilGraphHeight;o&&null!=o.graphHeight&&(s=o.graphHeight);const a=o&&o.layout||this.options.layout;if(a&&i&&e.FunctionExt.call(a,this,i,o),!s){const t=this.getGraph(n);t.fitToContent({minWidth:t.options.width,gridHeight:1,padding:o&&o.graphPadding||this.options.stencilGraphPadding||10})}return this}onDragStart(t){const{e:e,node:n}=t;this.dnd.start(n,e)}filter(t,n){const i=Object.keys(this.graphs).reduce(((i,o)=>{const s=this.graphs[o],l=o===a.defaultGroupName?null:o,r=s.model.getNodes().filter((i=>{let o=!1;o="function"==typeof n?e.FunctionExt.call(n,this,i,t,l,this):"boolean"==typeof n?n:this.isCellMatched(i,t,n,t.toLowerCase()!==t);const a=s.renderer.findViewByCell(i);return a&&e.Dom.toggleClass(a.container,"unmatched",!o),o})),c=r.length>0,p=this.options,d=new e.Model;return d.resetCells(r),p.layout&&e.FunctionExt.call(p.layout,this,d,this.getGroup(o)),this.groups[o]&&e.Dom.toggleClass(this.groups[o],"unmatched",!c),s.fitToContent({gridWidth:1,gridHeight:1,padding:p.stencilGraphPadding||10}),i||c}),!1);e.Dom.toggleClass(this.container,"not-found",!i)}isCellMatched(t,e,n,i){return!e||!n||Object.keys(n).some((o=>{if("*"===o||t.shape===o){const s=n[o];if("boolean"==typeof s)return s;return(Array.isArray(s)?s:[s]).some((n=>{let o=t.getPropByPath(n);return null!=o&&(o=`${o}`,i||(o=o.toLowerCase()),o.indexOf(e)>=0)}))}return!1}))}onSearch(t){this.filter(t.target.value,this.options.search)}onSearchFocusIn(){e.Dom.addClass(this.container,"is-focused")}onSearchFocusOut(){e.Dom.removeClass(this.container,"is-focused")}onTitleClick(){this.options.collapsable&&(e.Dom.toggleClass(this.container,"collapsed"),e.Dom.hasClass(this.container,"collapsed")?this.collapseGroups():this.expandGroups())}onGroupTitleClick(t){const n=t.target.closest(`.${this.prefixClassName(s.group)}`);n&&this.toggleGroup(e.Dom.attr(n,"data-name")||"");const i=Object.keys(this.groups).every((t=>{const n=this.getGroup(t),i=this.groups[t];return n&&!1===n.collapsable||e.Dom.hasClass(i,"collapsed")}));e.Dom.toggleClass(this.container,"collapsed",i)}getModel(t){const e=this.getGraph(t);return e?e.model:null}getGraph(t){return this.graphs[t||a.defaultGroupName]}getGroup(t){const e=this.options.groups;return null!=t&&e&&e.length?e.find((e=>e.name===t)):null}toggleGroup(t){return this.isGroupCollapsed(t)?this.expandGroup(t):this.collapseGroup(t),this}collapseGroup(t){if(this.isGroupCollapsable(t)){const n=this.groups[t];n&&!this.isGroupCollapsed(t)&&(this.trigger("group:collapse",{name:t}),e.Dom.addClass(n,"collapsed"))}return this}expandGroup(t){if(this.isGroupCollapsable(t)){const n=this.groups[t];n&&this.isGroupCollapsed(t)&&(this.trigger("group:expand",{name:t}),e.Dom.removeClass(n,"collapsed"))}return this}isGroupCollapsable(t){const n=this.groups[t];return e.Dom.hasClass(n,"collapsable")}isGroupCollapsed(t){const n=this.groups[t];return n&&e.Dom.hasClass(n,"collapsed")}collapseGroups(){return Object.keys(this.groups).forEach((t=>this.collapseGroup(t))),this}expandGroups(){return Object.keys(this.groups).forEach((t=>this.expandGroup(t))),this}resizeGroup(t,e){const n=this.graphs[t];return n&&n.resize(e.width,e.height),this}onRemove(){Object.keys(this.graphs).forEach((t=>{this.graphs[t].view.remove(),delete this.graphs[t]})),this.dnd.remove(),this.stopListening(),this.undelegateDocumentEvents()}dispose(){this.remove(),e.CssLoader.clean(this.name)}}var s,a;!function(t,e,n,i){var o,s=arguments.length,a=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var l=t.length-1;l>=0;l--)(o=t[l])&&(a=(s<3?o(a):s>3?o(e,n,a):o(e,n))||a);s>3&&a&&Object.defineProperty(e,n,a)}([e.View.dispose()],o.prototype,"dispose",null),function(t){t.defaultOptions=Object.assign({stencilGraphWidth:200,stencilGraphHeight:800,title:"Stencil",collapsable:!1,placeholder:"Search",notFoundText:"No matches found",layout(t,n){const o={columnWidth:this.options.stencilGraphWidth/2-10,columns:2,rowHeight:80,resizeToFit:!1,dx:10,dy:10};!function(t,n={}){const o=e.Model.isModel(t)?t:(new e.Model).resetCells(t,{sort:!1,dryrun:!0}),s=o.getNodes(),a=n.columns||1,l=Math.ceil(s.length/a),r=n.dx||0,c=n.dy||0,p=!1!==n.center,d=!0===n.resizeToFit,g=n.marginX||0,h=n.marginY||0,u=[];let x=n.columnWidth;if("compact"===x)for(let t=0;t<a;t+=1){const e=i.getNodesInColumn(s,t,a);u.push(i.getMaxDim(e,"width")+r)}else{null!=x&&"auto"!==x||(x=i.getMaxDim(s,"width")+r);for(let t=0;t<a;t+=1)u.push(x)}const m=i.accumulate(u,g),f=[];let w=n.rowHeight;if("compact"===w)for(let t=0;t<l;t+=1){const e=i.getNodesInRow(s,t,a);f.push(i.getMaxDim(e,"height")+c)}else{null!=w&&"auto"!==w||(w=i.getMaxDim(s,"height")+c);for(let t=0;t<l;t+=1)f.push(w)}const b=i.accumulate(f,h);o.startBatch("layout"),s.forEach(((t,e)=>{const i=e%a,o=Math.floor(e/a),s=u[i],l=f[o];let g=0,h=0,x=t.getSize();if(d){let e=s-2*r,i=l-2*c;const o=x.height*(x.width?e/x.width:1),a=x.width*(x.height?i/x.height:1);l<o?e=a:i=o,x={width:e,height:i},t.setSize(x,n)}p&&(g=(s-x.width)/2,h=(l-x.height)/2),t.position(m[i]+r+g,b[o]+c+h,n)})),o.stopBatch("layout")}(t,Object.assign(Object.assign(Object.assign({},o),this.options.layoutOptions),n?n.layoutOptions:{}))}},n.Dnd.defaults)}(o||(o={})),function(t){t.base="widget-stencil",t.title=`${t.base}-title`,t.search=`${t.base}-search`,t.searchText=`${t.search}-text`,t.content=`${t.base}-content`,t.group=`${t.base}-group`,t.groupTitle=`${t.group}-title`,t.groupContent=`${t.group}-content`}(s||(s={})),function(t){t.defaultGroupName="__default__"}(a||(a={})),t.Stencil=o}));
//# sourceMappingURL=index.js.map
